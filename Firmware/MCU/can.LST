C166 COMPILER V7.53.0.0, CAN                                                               07/18/2016 12:21:32 PAGE 1   


C166 COMPILER V7.53.0.0, COMPILATION OF MODULE CAN
OBJECT MODULE PLACED IN can.OBJ
COMPILER INVOKED BY: C:\Keil\C166\BIN\C166.EXE can.c BROWSE MOD167 DEBUG TABS(2) 

 stmt lvl     source

    1         #include "can.h"
    2         
    3         void CAN_Init()
    4         {
    5  1        DP4 &= 0x00CF;          // P4.4 P4.5 Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼ Ð½Ð° Ð²Ð²Ð¾Ð´(Ð²Ñ…Ð¾Ð´ CAN ÑƒÐ·Ð»Ð° 0 Ð¸ ÑƒÐ·Ð»Ð° 
             -1)
    6  1        ALTSEL0P4 &= 0x00DF;          // Ð’Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½ÑƒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ P4.5(Ð´Ð»Ñ
             - P4.4 Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð´ÐµÐ»Ð°ÐµÐ¼)
    7  1        DP4 |= 0x00C0;          // P4.6 P4.7 Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼ Ð½Ð° Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ñƒ(Ð’Ñ‹Ñ…Ð¾Ð´ CAN ÑƒÐ·Ð»Ð° 0 Ð
             -¸ ÑƒÐ·Ð»Ð° 1)
    8  1        ALTSEL0P4 |= 0x00C0;          // Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ P4.6 Ð¸ P4.7
    9  1      
   10  1        CAN_IC0 = 0x005C;
   11  1        CAN_IC1 = 0x0060; 
   12  1        CAN_IC2 = 0x0074; 
   13  1        
   14  1        NCR0  = 0x0041;   //Ñ€Ð°Ð·Ñ€ÐµÑˆÐ°ÐµÐ¼ Ð²Ð½Ð¾ÑÐ¸Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ
   15  1        NPCR0 = 0x0000;   //Ð’Ñ‹Ð±Ñ€Ð°Ð»Ð¸ P4.5 Ð´Ð»Ñ Ð¿Ñ€Ð¸ÐµÐ¼Ð° Ð² CAN ÑƒÐ·ÐµÐ» 0
   16  1        NBTR0 = 0x2341;   //ÑÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ ÑƒÐ·Ð»Ð° 500kb/sec Ð¿Ñ€Ð¸ Ñ‚Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ 16ÐœÐ³Ñ†
   17  1        NCR0  = 0x0000;   //Ð—Ð°Ð¿Ñ€ÐµÑ‚ Ð¿Ð¾ÑÐ»Ðµ Ñ€ÐµÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
   18  1        
   19  1        CAN_Message_16[0].MOCTRH = 0x0E08;
   20  1        CAN_Message_16[0].MOCTRL = 0x0000;
   21  1        CAN_Message_16[0].MOIPRL = 0x0000;  /*Ð²Ñ‹Ð±Ð¾Ñ€ Ð»Ð¸Ð½Ð¸Ð¸ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ð¹ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð¸ -
             - 0*/
   22  1        CAN_Message_16[0].MOFCRH = 0x0800; // DLC = 8, Ð·Ð°Ð¿Ñ€ÐµÑ‚Ð¸Ñ‚ÑŒ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° Ð¿ÐµÑ€ÐµÐ´Ð°
             -Ñ‡Ñƒ 
   23  1        
   24  1        CAN_Message_16[1].MOCTRH = 0x0080;
   25  1        CAN_Message_16[1].MOCTRL = 0x0000;
   26  1        CAN_Message_16[1].MOIPRL = 0x0000;  // Ð²Ñ‹Ð±Ð¾Ñ€ Ð»Ð¸Ð½Ð¸Ð¸ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ð¹ Ð¿Ð¾ Ð¿Ñ€Ð¸ÐµÐ¼Ñƒ - 0
   27  1        CAN_Message_16[1].MOFCRH = 0x0801;  //Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÐ½Ð¸Ðµ Ð½Ð° Ð¿Ñ€Ð¸ÐµÐ¼
   28  1        
   29  1        CAN_Message_16[2].MOCTRH = 0x0080;
   30  1        CAN_Message_16[2].MOCTRL = 0x0000;
   31  1        CAN_Message_16[2].MOIPRL = 0x0002;  // Ð²Ñ‹Ð±Ð¾Ñ€ Ð»Ð¸Ð½Ð¸Ð¸ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ð¹ Ð¿Ð¾ Ð¿Ñ€Ð¸ÐµÐ¼Ñƒ - 2
   32  1        CAN_Message_16[2].MOFCRH = 0x0801;  //Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÐ½Ð¸Ðµ Ð½Ð° Ð¿Ñ€Ð¸ÐµÐ¼
   33  1      
   34  1        CAN_Message_16[3].MOCTRH = 0x0E08;
   35  1        CAN_Message_16[3].MOCTRL = 0x0000;
   36  1        CAN_Message_16[3].MOIPRL = 0x0010;  // Ð²Ñ‹Ð±Ð¾Ñ€ Ð»Ð¸Ð½Ð¸Ð¸ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ð¹ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð¸
             - - 1
   37  1        CAN_Message_16[3].MOFCRH = 0x0802;  // Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ñƒ
   38  1        
   39  1        CAN_Message_16[4].MOCTRH = 0x0E08;
   40  1        CAN_Message_16[4].MOCTRL = 0x0000;
   41  1        CAN_Message_16[4].MOIPRL = 0x0000;  // Ð²Ñ‹Ð±Ð¾Ñ€ Ð»Ð¸Ð½Ð¸Ð¸ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ð¹ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð¸
             - 
   42  1        CAN_Message_16[4].MOFCRH = 0x0800;  // DLC = 8, Ð·Ð°Ð¿Ñ€ÐµÑ‚ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ð¹ 
   43  1        
   44  1        delay(10);
   45  1        
   46  1        CAN_Message_16[0].MOARH = 0x8000;  // Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ 000h
   47  1        CAN_Message_16[0].MOAMRH = 0x3FFF; // Ð¼Ð°ÑÐºÐ° Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð° 
   48  1          
C166 COMPILER V7.53.0.0, CAN                                                               07/18/2016 12:21:32 PAGE 2   

   49  1        CAN_Message_16[1].MOARH = 0x8400;  // Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ 100h
   50  1        CAN_Message_16[1].MOAMRH = 0x3FFF; // Ð¼Ð°ÑÐºÐ° Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð°   
   51  1        
   52  1        CAN_Message_16[2].MOARH = 0x8404;  // Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ 101h
   53  1        CAN_Message_16[2].MOAMRH = 0x3FFF; // Ð¼Ð°ÑÐºÐ° Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð°   
   54  1        
   55  1        CAN_Message_16[3].MOARH = 0x8804;  // Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ 201h
   56  1        CAN_Message_16[3].MOAMRH = 0x3FFF; // Ð¼Ð°ÑÐºÐ° Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð° 
   57  1        
   58  1        CAN_Message_16[4].MOARH = 0x8004;  // Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ 001h
   59  1        CAN_Message_16[4].MOAMRH = 0x3FFF; // Ð¼Ð°ÑÐºÐ° Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð° 
   60  1      
   61  1        delay(10);
   62  1        
   63  1        PANCTR_H = 0x0100;         // message object 0 -> List 1
   64  1        PANCTR = 0x0002;           
   65  1         _nop_(); _nop_(); _nop_(); _nop_(); _nop_(); _nop_();
   66  1         
   67  1        PANCTR_H = 0x0101;         // message object 1 -> List 1
   68  1        PANCTR = 0x0002;             
   69  1         _nop_(); _nop_(); _nop_(); _nop_(); _nop_(); _nop_(); 
   70  1         
   71  1         
   72  1        PANCTR_H = 0x0102;         // message object 2 -> List 1
   73  1        PANCTR = 0x0002;             
   74  1         _nop_(); _nop_(); _nop_(); _nop_(); _nop_(); _nop_();   
   75  1         
   76  1        PANCTR_H = 0x0103;         // message object 3 -> List 1
   77  1        PANCTR = 0x0002;             
   78  1         _nop_(); _nop_(); _nop_(); _nop_(); _nop_(); _nop_();   
   79  1      
   80  1      
   81  1        PANCTR_H = 0x0104;         // message object 4 -> List 1
   82  1        PANCTR = 0x0002;             
   83  1         _nop_(); _nop_(); _nop_(); _nop_(); _nop_(); _nop_();   
   84  1      
   85  1      
   86  1        CAN_Message_16[0].MOCTRH = 0x0020; 
   87  1        CAN_Message_16[0].MOCTRL = 0x0000;
   88  1        
   89  1        CAN_Message_16[1].MOCTRH = 0x0020; 
   90  1        CAN_Message_16[1].MOCTRL = 0x0000;
   91  1        
   92  1        CAN_Message_16[2].MOCTRH = 0x0020; 
   93  1        CAN_Message_16[2].MOCTRL = 0x0000;
   94  1        
   95  1        CAN_Message_16[3].MOCTRH = 0x0020; 
   96  1        CAN_Message_16[3].MOCTRL = 0x0000;
   97  1        
   98  1        CAN_Message_16[4].MOCTRH = 0x0020; 
   99  1        CAN_Message_16[4].MOCTRL = 0x0000;  
  100  1        
  101  1      }
  102         void CAN_SendMessage(char *buffer)
  103         {
  104  1        CAN_Message_16[0].MODATALL = buffer[0];
  105  1        CAN_Message_16[0].MODATALH = buffer[1];
  106  1        CAN_Message_16[0].MODATAHL = buffer[2];
  107  1        CAN_Message_16[0].MODATAHH = buffer[3];
  108  1        
  109  1        CAN_Message_16[0].MOCTRH = 0x0100;  
  110  1      }
C166 COMPILER V7.53.0.0, CAN                                                               07/18/2016 12:21:32 PAGE 3   



MODULE INFORMATION:   INITIALIZED  UNINITIALIZED
  CODE SIZE        =         590     --------
  NEAR-CONST SIZE  =    --------     --------
  FAR-CONST SIZE   =    --------     --------
  HUGE-CONST SIZE  =    --------     --------
  XHUGE-CONST SIZE =    --------     --------
  NEAR-DATA SIZE   =    --------     --------
  FAR-DATA SIZE    =    --------     --------
  XHUGE-DATA SIZE  =    --------     --------
  IDATA-DATA SIZE  =    --------     --------
  SDATA-DATA SIZE  =    --------     --------
  BDATA-DATA SIZE  =    --------     --------
  HUGE-DATA SIZE   =    --------     --------
  BIT SIZE         =    --------     --------
  INIT'L SIZE      =    --------     --------
END OF MODULE INFORMATION.


C166 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
